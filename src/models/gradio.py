three_little_pigs_esp = """
Érase una vez una madre cerda anciana que tenía tres cerditos y no tenía suficiente comida para alimentarlos. Entonces, cuando tuvieron la edad suficiente, los envió al mundo en busca de fortuna.
El primer cerdito era muy perezoso. No quería trabajar en absoluto y construyó su casa con paja. El segundo cerdito trabajó un poco más pero también era un poco perezoso y construyó su casa con palos. Luego, cantaron, bailaron y jugaron juntos el resto del día.
El tercer cerdito trabajó duro todo el día y construyó su casa con ladrillos. Era una casa robusta completa con una hermosa chimenea y chimenea. Parecía que podía soportar los vientos más fuertes.
Al día siguiente, un lobo pasó por casualidad por el camino donde vivían los tres cerditos; y vio la casa de paja, y olió el cerdo dentro. Pensó que el cerdo sería una excelente comida y se le hizo agua la boca.
Entonces llamó a la puerta y dijo: "¡Cerdito! ¡Cerdito! ¡Déjame entrar! ¡Déjame entrar!"
Pero el cerdito vio las grandes patas del lobo a través del ojo de la cerradura, así que respondió: "¡No! ¡No! ¡No! ¡No por los pelos de mi mentón!"
Casa de paja de los tres cerditos Entonces el lobo mostró los dientes y dijo: "Entonces soplaré y soplaré y derribaré tu casa".
¡Así que resopló y resopló y derribó la casa! El lobo abrió mucho sus fauces y mordió con todas sus fuerzas, pero el primer cerdito se escapó y corrió a esconderse con el segundo cerdito.
El lobo siguió por el camino y pasó por la segunda casa hecha de palos; y vio la casa, y olió a los cerdos dentro, y se le hizo agua la boca al pensar en la buena cena que harían.
Entonces llamó a la puerta y dijo: "¡Cerditos! ¡Cerditos! ¡Déjame entrar! ¡Déjame entrar!"
Pero los cerditos vieron las orejas puntiagudas del lobo a través del ojo de la cerradura, por lo que respondieron: "¡No! ¡No! ¡No! ¡No por los pelos de nuestra barbilla!"
Entonces el lobo mostró sus dientes y dijo: "¡Entonces resoplaré y resoplaré y derribaré tu casa!"
¡Así que resopló y resopló y derribó la casa! El lobo era codicioso y trató de atrapar a los dos cerdos a la vez, ¡pero era demasiado codicioso y no consiguió ninguno! Sus grandes mandíbulas se cerraron contra nada más que aire y los dos cerditos se alejaron tan rápido como sus pequeños cascos se los permitieron.
El lobo los persiguió por el camino y casi los atrapa. Pero llegaron a la casa de ladrillos y cerraron la puerta antes de que el lobo pudiera atraparlos. Los tres cerditos estaban muy asustados, sabían que el lobo se los quería comer. Y eso era muy, muy cierto. El lobo no había comido en todo el día y había tenido un gran apetito persiguiendo a los cerdos y ahora podía olerlos a los tres adentro y sabía que los tres cerditos harían un delicioso festín.
Entonces el lobo llamó a la puerta y dijo: "¡Cerditos! ¡Cerditos! ¡Déjame entrar! ¡Déjame entrar!"
Pero los cerditos vieron los ojos entrecerrados del lobo a través del ojo de la cerradura, por lo que respondieron: "¡No! ¡No! ¡No! ¡No por los pelos de nuestra barbilla!"
Así que el lobo mostró los dientes y dijo: "Entonces resoplaré y resoplaré y derribaré tu casa".
¡Bien! resopló y resopló. Resopló y resopló. Y sopló, sopló, y sopló, sopló; pero no pudo derribar la casa. Por fin, estaba tan sin aliento que no podía resoplar y no podía resoplar más. Así que se detuvo a descansar y pensó un poco.
Pero esto fue demasiado. El lobo bailaba de rabia y juró que bajaría por la chimenea y se comería al cerdito como cena. Pero mientras subía al techo, el cerdito encendió un fuego ardiente y puso a hervir una olla grande llena de agua. Entonces, justo cuando el lobo bajaba por la chimenea, el cerdito quitó la tapa y ¡plop! cayó el lobo en el agua hirviendo.
Así que el cerdito volvió a poner la tapa, hirvió al lobo y los tres cerditos se lo comieron como cena.
"""

dua_lipa_story = """
Dua Lipa, una reconocida cantante internacional, decidió hacer una parada en Santiago de Chile durante su gira mundial. Llegó a la ciudad llena de emoción y curiosidad por explorar la cultura y la belleza de este país sudamericano.
Uno de los lugares que le llamó especialmente la atención fue el famoso Cerro San Cristóbal, una imponente colina ubicada en el corazón de la ciudad. Dua Lipa decidió que sería una experiencia única subir hasta la cima y disfrutar de las impresionantes vistas panorámicas de Santiago.
Acompañada por un pequeño grupo de amigos y seguidores chilenos, Dua Lipa emprendió el ascenso al Cerro San Cristóbal. Mientras caminaban por los senderos serpenteantes, admiraban la exuberante vegetación y la arquitectura característica de la zona.
Al llegar a la cima, Dua Lipa quedó maravillada por la vista de la ciudad extendiéndose ante ella. La cantante aprovechó el momento para tomarse fotografías con el icónico teleférico y el imponente Santuario de la Inmaculada Concepción, una estatua de la Virgen María que domina el paisaje.
Después de disfrutar de la belleza del Cerro San Cristóbal, Dua Lipa y su grupo decidieron descender y explorar los alrededores. Encontraron un puesto de comida típica chilena y decidieron probar algo refrescante para combatir el calor.
Fue entonces cuando Dua Lipa descubrió el mote con huesillo, una bebida tradicional chilena hecha con trigo remojado y endulzado con jugo de durazno. Curiosa por probar algo auténtico de la región, decidió pedir un vaso de esta delicia refrescante.
Mientras disfrutaba de su mote con huesillo, Dua Lipa compartía risas y anécdotas con sus amigos y los chilenos que se acercaban a saludarla. El ambiente era festivo y lleno de alegría, creando un vínculo especial entre la famosa cantante y la cultura chilena.
Después de un rato agradable en el puesto de comida, Dua Lipa y su grupo continuaron explorando las calles de Santiago, mezclándose con la energía vibrante de la ciudad y disfrutando de la hospitalidad de su gente.
La visita de Dua Lipa a Santiago de Chile quedó grabada en la memoria de todos los que tuvieron la suerte de encontrarse con ella. La cantante se llevó consigo no solo la experiencia de subir al Cerro San Cristóbal y disfrutar del mote con huesillo, sino también el amor y el cariño de los chilenos que la recibieron con los brazos abiertos.
Y así, con nuevos recuerdos y una mayor apreciación por la cultura chilena, Dua Lipa continuó su gira mundial, llevando consigo un pedacito de Santiago en su corazón.
"""

import gradio as gr

def generate_pipeline_title_and_description(title, description):
  markdown = f"""<h1 style="text-align: center;">{title}</h1> <h3>{description}</h3>"""
  return markdown

def generate_html_list(items_title, items):
    html = f"""
            <h1>{items_title}</h1>
              <ul>
            """
    for item in items:
        html += f"<li>{item}</li>"
    html +=f"</ul>"
    return html

pandreamonium_english_texts = {
    # Global Interface
    "pandreamonium_title": "PANDREAMONIUM: A Dream Visualization System Using Free Knowledge and Natural Language Processing.",
    "pandreamonium_description": "",
    # Global variables
    "text_label": "Story description",
    "text_info": "Enter a plain text description of a story, and visualize the possibilities...",
    "text_placeholder": "A long time ago, in a galaxy far, far away...",
    # Buttons
    "reset_btn_value": "Reset",
    "submit_btn_value": "Process",
    "cancel_btn_value": "Cancel",
    # Errors
    "no_text_error": "You must enter a valid text to run the application",
    # Word Cloud
    "word_cloud_pipeline_title": "Cloud of Words and most frequent Lemmatized Words",
    "word_cloud_pipeline_description": "Generates a word cloud and gets the most frequent lemmatized words from the text entered as input",
    "word_cloud_image_label": "Word Cloud",
    "word_cloud_top_words_label": "Top {} most frequent lemmatized words:",
    # Key Concepts
    "key_concepts_pipeline_title": "Key Concepts Extractor",
    "key_concepts_pipeline_description": "Generates summary extracts from the original text and extracts key concepts",
    "key_concepts_label": "Key concepts detected:",
    "max_extract_length_label": "Size of the extracts to summarize",
    "max_extract_length_info": "The original text is divided into N extracts of this size to analyze them separately",
    "n_key_concepts_label": "Number of key concepts per extract",
    "n_key_concepts_info": "Number of key concepts that will be obtained from each extract to later be consolidated (It must be consistent with the length of the original text and the length of the extracts)",
    # NER
    "ner_pipeline_title": "Named Entity Recognition",
    "ner_pipeline_description": "Detection of mentioned entities and search for others that are related",
    #['Instances of', 'Part of', 'Countries', 'Founded by', 'Occupations', 'Sex or Gender', 'Fields of Work', 'Awards Received', 'Countries of Citizenship', 'Places of Birth', 'Places of Education']
    "ner_pipeline_properties_names": {
        'Instances of': 'instances_of',
        'Part of': 'part_of',
        'Countries': 'countries',
        'Founded by': 'founded_by',
        'Occupations': 'occupations',
        'Sex or Gender': 'sex_or_gender',
        'Work Fields': 'work_fields',
        'Awards Received': 'awards_received',
        'Countries of Citizenship': 'countries_of_citizenship',
        'Places of Birth': 'places_of_birth',
        'Educated at': 'educated_at',
    },
    "selected_props_label": "Properties to Consider",
    "selected_props_info": "List of properties to consider when searching for similar entities (the search makes an exact match, the more number of properties the more rigid the query)",
    "properties_per_category_label": "Properties per Category",
    "properties_per_category_info": "The more properties per category, the stricter the query (Potentially more similar entities at the cost of longer execution time)",
    "result_limit_label": "Number of Related Entities",
    "result_limit_info": "Number of entities to which the search will be limited (the more there are, the more computational power will be necessary)",
    "query_timeout_label": "Time limit to terminate each request [seconds]",
    "query_timeout_info": "When searching for similar entities, several requests are made to the application. It is recommended to adjust it proportionally to the number of properties per category",
    "ner_pipeline_html_headers": {
        "page_title": "NER Pipeline Results",
        "result_title": "Detected Entities:",
        "occurrences_title": "Occurrences in original text:",
        "instance_similar_entities_title": "Entities with some degree of relationship that match the selected properties:",
        "specific_similar_entities_title": "Entities that match the entire list of properties and the number of properties:", 
        "no_entities_title": "No entities were found in the entered text.",
    },
    # Stable Diffusion
    "stable_diffusion_pipeline_title": "Text Illustrations",
    "stable_diffusion_pipeline_description": "Text illustrations created by generative models (in this case stable diffusion 1.5 is used)",
    "prompt_style_label": "Select a style for the images that will be generated",
    "prompt_style_info": "You can choose a preset style, pick one at random, or define your own style using prompt engineering techniques",
    "n_rows_label": "Number of rows per illustrated extract",
    "n_rows_info": "Each extract will have an illustration matrix of dimensions number of rows by number of columns",
    "n_cols_label": "Number of columns per illustrated extract",
    "n_cols_info": "Each extract will have an illustration matrix of dimensions number of rows by number of columns",
    "stable_diffusion_images_label": "Story Line Images",
    "custome_prompt_style_label": "Enter the style you prefer",
    "custome_prompt_style_info": "Remember that you must enter the style using prompt engineering techniques",
    "custome_prompt_style_placeholder": "fantasy art, landscape art, environment art, in the style of greg rutkowski, illustration, epic, fantasy, artstation, trending in artstation.",
}


pandreamonium_spanish_texts = {
    # Global Interface
    "pandreamonium_title": "PANDREAMONIUM: Un sistema de visualización de sueños utilizando conocimiento libre y procesamiento de lenguaje natural.",
    "pandreamonium_description": "",
    # Global variables
    "text_label": "Descripción del relato",
    "text_info": "Ingresa una descripción en texto plano de una historia, y visualiza las posibilidades...",
    "text_placeholder": "Hace mucho tiempo, en una galaxia muy, muy lejana...",
    # Buttons
    "reset_btn_value": "Restablecer",
    "submit_btn_value": "Procesar",
    "cancel_btn_value": "Cancelar",
    # Errors
    "no_text_error": "Debes ingresar un texto válido para ejecutar la aplicación",
    # Word Cloud
    "word_cloud_pipeline_title": "Nube de Palabras y Palabras Lematizadas más frecuentes",
    "word_cloud_pipeline_description": "Genera una nube de palabras y obtiene las palabras lematizadas más frecuentes del texto ingresado",
    "word_cloud_image_label": "Nube de palabras",
    "word_cloud_top_words_label": "Principales {} palabras lematizadas más frecuentes:",
    # Key Concepts
    "key_concepts_pipeline_title": "Extractor de Conceptos Clave",
    "key_concepts_pipeline_description": "Genera extractos resumidos del texto original y extrae conceptos clave",
    "key_concepts_label": "Conceptos clave detectados:",
    "max_extract_length_label": "Tamaño de los extractos a resumir",
    "max_extract_length_info": "El texto original se divide en N extractos de este tamaño para analizarlos por separado",
    "n_key_concepts_label": "Número de conceptos clave por extracto",
    "n_key_concepts_info": "Número de conceptos clave que se obtendrán de cada extracto para luego consolidarlos (Debe ser consistente con el largo del texto original y el largo de los extractos)",
    # NER
    "ner_pipeline_title": "Reconocimiento de Entidades Nombradas",
    "ner_pipeline_description": "Detección de entidades mencionadas y búsqueda de otras que estén relacionadas",
    #['Instancias de', 'Parte de', 'Países', 'Fundado por', 'Ocupaciones', 'Sexo o Género', 'Campos de Trabajo', 'Premios Recibidos', 'Países de Ciudadanía', 'Lugares de Nacimiento', 'Lugares de Educación']
    "ner_pipeline_properties_names": {
        'Instancias de': 'instances_of',
        'Parte de': 'part_of',
        'Países': 'countries',
        'Fundado por': 'founded_by',
        'Ocupaciones': 'occupations',
        'Sexo o Género': 'sex_or_gender',
        'Campos de Trabajo': 'work_fields',
        'Premios Recibidos': 'awards_received',
        'Países de Ciudadanía': 'countries_of_citizenship',
        'Lugares de Nacimiento': 'places_of_birth',
        'Lugares de Educación': 'educated_at',
    },
    "selected_props_label": "Propiedades a Considerar",
    "selected_props_info": "Lista de propiedades a considerar al momento de buscar entidades similares (la búsqueda hace una coincidencia exacta, a mayor número de propiedades más rígida la consulta)",
    "properties_per_category_label": "Propiedades por Categoría",
    "properties_per_category_info": "Cuantas más propiedades por categoría, más estricta será la consulta (Entidades posiblemente más similares a costa de un tiempo de ejecución más largo)",
    "result_limit_label": "Número de Entidades Relacionadas",
    "result_limit_info": "Número de entidades a las que se limitará la búsqueda (cuantas más sean, más potencia computacional será necesaria)",
    "query_timeout_label": "Límite de tiempo para terminar cada solicitud [segundos]",
    "query_timeout_info": "Al buscar entidades similares, se realizan varias solicitudes a la aplicación. Se recomienda ajustarlo proporcionalmente al número de propiedades por categoría",
    "ner_pipeline_html_headers": {
        "page_title": "NER Pipeline Results",
        "result_title": "Entidades Detectadas:",
        "occurrences_title": "Apariciones en el texto original:",
        "instance_similar_entities_title": "Entidades con algún grado de relación que coinciden con las propiedades seleccionadas:",
        "specific_similar_entities_title": "Entidades que coinciden con toda la lista de propiedades y con el número de propiedades:",
        "no_entities_title": "No se encontraron entidades en el texto ingresado.",
    },
    # Stable Diffusion
    "stable_diffusion_pipeline_title": "Ilustraciones del texto",
    "stable_diffusion_pipeline_description": "Ilustraciones del texto creadas por modelos generativos (en este caso se usa stable diffusion 1.5)",
    "prompt_style_label": "Selecciona un estilo para las imágenes que se generarán",
    "prompt_style_info": "Puedes elegir un estilo preestablecido, elegir uno al azar o definir tu propio estilo usando técnicas de prompt engineering",
    "n_rows_label": "Número de filas por extracto ilustrado",
    "n_rows_info": "Cada extracto tendrá una matriz de ilustración de dimensiones número de filas por número de columnas",
    "n_cols_label": "Número de columnas por extracto ilustrado",
    "n_cols_info": "Cada extracto tendrá una matriz de ilustración de dimensiones número de filas por número de columnas",
    "stable_diffusion_images_label": "Imágenes del Story Line",
    "custome_prompt_style_label": "Ingresa el estilo que prefieras",
    "custome_prompt_style_info": "Recuerda que debes ingresar el estilo utilizando técnicas de prompt engineering",
    "custome_prompt_style_placeholder": "fantasy art, landscape art, environment art, in the style of greg rutkowski, illustration, epic, fantasy, artstation, trending in artstation.",
}


pandreamonium_texts = pandreamonium_spanish_texts

example_mapping = {
    "Los Tres Chanchitos": three_little_pigs_esp,
    "Dua Lipa en el Cerro San Cristóbal": dua_lipa_story,
}
gradio_examples = [["Los Tres Chanchitos"], ["Dua Lipa en el Cerro San Cristóbal"]]

def load_example(example_id):
    global example_mapping
    global gradio_examples
    return example_mapping[gradio_examples[example_id][0]]


def replace_and_capitalize(text):
    words = text.split('_')  # Dividir la cadena en palabras separadas por guiones bajos
    capitalized_words = [word.capitalize() for word in words]  # Capitalizar cada palabra
    return ' '.join(capitalized_words)  # Unir las palabras con espacios en blanco

def generate_entities_html(data, html_headers):
    html = f'''
    <!DOCTYPE html>
    <html>
    <head>
      <title>{html_headers["page_title"]}</title>
    </head>
    <body>
      <h1>{html_headers["result_title"]}</h1>
    '''
    if data:
      for key, value in data.items():
          html += f'<h2>{key}</h2>' # Subtitulo con la Entidad
          # Propiedades solo si la entidad es distinta de MISC
          if value["entity_label"]!="MISC":
            html += '<ul>' # Comenzar bullet points
            # Iterar sobre las propiedades
            for prop, prop_value in value['entity_properties'].items():
                # Si es >1 resultado, concatenación mediante ,
                if isinstance(prop_value, list):
                    prop_value = ', '.join(prop_value)
                if prop == 'image_url':
                    html += f'<img src="{prop_value}" alt="{key}" width="300" height="200">'
                else:
                    html += f'<li>{replace_and_capitalize(prop)}: {prop_value}</li>'
            html += '</ul>'

          # Apariciones en el texto original
          html += f'<h3>{html_headers["occurrences_title"]}</h3>'
          html += '<ul>'
          for sentence in value["sentences"]:
            html += f'<li>{sentence}</li>'
          html += '</ul>'

          # Entidades similares solo si la entidad es distinta de MISC
          if value["entity_label"]!="MISC":
            html += f'<h3>{html_headers["instance_similar_entities_title"]}</h3>'
            html += '<ul>'
            for entity, url in value['related_entities']['instance_similar_entities'].items():
                html += f'<li><a href="{url}" target="_blank">{entity}</a></li>'
            html += '</ul>'
            html += f'<h3>{html_headers["specific_similar_entities_title"]}</h3>'
            html += '<ul>'
            for entity, url in value['related_entities']['specific_similar_entities'].items():
                html += f'<li><a href="{url}" target="_blank">{entity}</a></li>'
            html += '</ul>'

    # No data (No entities founded)
    else:
        html += f'<p>{html_headers["no_entities_title"]}</p>'
    html += '''
    </body>
    </html>
    '''

    return html